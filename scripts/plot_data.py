#!/usr/bin/env python3
import argparse
import csv
import pandas as pd
import matplotlib.pyplot as plt
import numpy as np


def plot_entropy(df):
    # get current axis
    axes = plt.gca()
    df.plot(kind='line', x='frame', y='Pose_entropy', ax=axes)
    mean = np.nanmean(df.Pose_entropy)
    plt.axhline(y=mean, color='red', linestyle='--', label='mean')
    var = np.nanvar(df.Pose_entropy)
    std = np.sqrt(var)
    plt.fill_between(axes.get_xlim(),mean+std,mean-std, color='red', alpha=.5)
    plt.xlabel('Frames')
    plt.ylabel('Pose entropy')
    plt.show()

parser = argparse.ArgumentParser(
    description='Plot data from csv file generated by the KLTVO library.')

parser.add_argument('--file', '-f',
                    help='CSV file with the data to be plotted')

parser.add_argument('--plot_entropy',
                    action="store_true",
                    help='Plot pose entropy')

args = parser.parse_args()

fh = open(args.file)

csv_reader = csv.reader(fh)
csv_header = next(csv_reader)
fh.close()

df = pd.read_csv(args.file, header=None, skiprows=1, names=csv_header)

if(args.plot_entropy):
    plot_entropy(df)
